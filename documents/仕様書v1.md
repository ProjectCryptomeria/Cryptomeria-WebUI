## 📑 RaidChain WebUI 仕様書 (v1.1)

---

### 1. イントロダクション（序論）

- **1.1. 目的とスコープ**
  - **目的**: 従来のCLI/Shellスクリプトによる煩雑な操作を、TypeScript/Reactを用いたGUI操作に完全に置き換え、RaidChainの研究開発および運用効率を最大化する。
  - **スコープ**: Ignite buildで生成されたバイナリを用いた後の全ての操作（Dockerビルド、k8sデプロイ、アカウント管理、実験実行、モニタリング）をGUIで提供する。
- **1.2. 背景と課題**
  - **従来の課題**: 複雑な実験シナリオの作成がJustfileの「魔改造」に依存していた。k8s Jobを用いたニーモニック・ジェネシスブロックの管理やDatachainの柔軟なスケーリングが煩雑であった。
  - **WebUIによる解決**: 直感的なGUI操作と、APIサーバー（現段階ではMSWによる高度なシミュレーション）によるKubernetes操作の抽象化、およびアカウント管理により、これらの課題を解消する。
- **1.3. 究極の目的とビジョン**
  - Cosmosエコシステムを使った**モジュラーブロックチェーン** + **分散ストレージ＆Webホスティングシステム**を、手軽に操作し、研究開発するための統合WebUI。

---

### 2. システムアーキテクチャと依存関係

- **2.1. RaidChain システム構成**
  - **Datachain**（データ保存）、**Metachain**（メタデータ）、**Controlchain**（ロジック・統合管理）、**Relayer**（IBC通信）の4種類のチェーンで構成されるモジュラー型システム。
- **2.2. WebUIを含む全体アーキテクチャ**
  - **フロントエンド** (React 19/TS) が、**MSW (Mock Service Worker)** または **WebUI APIサーバー** を経由して、システム全体の状態を管理・可視化する。
  - ノードモニタリング、ブロック生成イベント、ビルドログには**仮想WebSocket (Virtual Socket)** を使用してリアルタイム性を担保する。
- **2.3. 技術スタック**
  - **フロントエンド**: **TypeScript**, **React 19**, **Zustand 5** (状態管理), **Tailwind CSS**, Vite。
  - **モック・シミュレーション**: **MSW 2.0 (Mock Service Worker)** - ブラウザ内でバックエンドロジックを完全再現。
  - **可視化**: **Recharts** (グラフ), **Lucide React** (アイコン)。
- **2.4. CLI操作の代替・吸収範囲**
  - **Dockerイメージの作成** (ログストリーミング含む)。
  - **k8s Jobによるニーモニック・ジェネシスブロック作成**。
  - **Helm ChartのInstall/Upgrade/Delete**によるデプロイ・スケーリング。
  - **TypeScriptを用いたオフチェーンコントローラー**による実験実行ロジック。

---

### 3. 機能要件（フロントエンド / WebUI）

- **3.1. ネットワークモニタリング**
  - **トポロジー（SVG）**: ノード配置とIBCパケット転送のアニメーション表示。
  - **Block Feed**: 全チェーン（Control/Meta/Data）で生成されたブロックをリアルタイムにタイムライン表示（Tx詳細確認可能）。
  - **Mempool**: 各ノードの未処理トランザクション滞留状況を棒グラフで表示。
  - **Node Registry**: 各ノードのHeight, Latency, Active状態の一覧表示。
- **3.2. デプロイメント・オペレーション**
  - Target Componentを選択したDockerイメージビルドの実行と`LogViewer`による**リアルタイムログストリーミング**。
  - Datachainのレプリカ数を**スライダー**で設定し、**スケーリング**（Helm Upgrade）を実行。
  - 確認付きの環境リセット機能。
- **3.3. アカウント/経済圏管理**
  - ユーザーアカウントの**作成/削除**。
  - **Faucet**実行（1000 TKN供給）。
  - 秘密鍵/ニーモニックの**安全な表示**（ブラーエフェクト付き）。
  - リレーヤーの残高不足を監視し、自動でFaucetを実行する**Watchdog機能**。
- **3.4. 実験シナリオ作成・実行**
  - **データソース**: 仮想データ生成、またはZip/ファイルアップロード（`FileTreeViewer`による構造解析）。
  - **パラメータ**: データサイズ/チャンクサイズの**範囲（Range）設定**。
  - **チェーン選択**: 対象チェーンの個別選択またはステップ実行設定。
  - **戦略**: Allocator/Transmitterの組み合わせ選択。
  - **実行管理**: 試算コスト自動計算、シナリオの一括生成と一括実行、リアルタイム実行進捗表示。
- **3.5. 実験結果ライブラリ**
  - 過去の実験結果（`ExperimentResult`）の一覧表示。
  - **フィルタリング・ソート・検索**機能。
  - 結果の詳細（スループット、経済コスト、パフォーマンスメトリクス）のモーダル表示。
  - **CSV/JSON形式**でのデータエクスポート。
- **3.6. プリセット管理**
  - 実験設定をプリセットとして保存・ロード・削除する機能。
  - 専用の管理画面および実験画面のサイドパネルからのアクセス。

---

### 4. 機能要件（バックエンド / シミュレーション）

_※現在はMSW (`src/shared/mocks/MockServer.ts`) によりブラウザ内でシミュレート_

- **4.1. チェーン制御シミュレーション**
  - ビルドジョブの遅延実行とログメッセージのストリーム配信。
  - スケーリング要求に基づくノード状態（Active/Inactive）の動的変更。
- **4.2. 経済シミュレーション**
  - ユーザーおよびシステムアカウント（Faucet Pool, Relayer）の残高管理。
  - Faucetによる残高移動ロジック。
- **4.3. 実験実行コントローラー**
  - シナリオに基づくコスト試算（Gas Price \* Data Size）。
  - 実験実行時の遅延シミュレーション（Upload/Download時間）。
  - 成功/失敗の確率的判定と、結果メトリクス（スループット等）の生成。
- **4.4. リアルタイム通信 (Virtual Socket)**
  - `/ws/monitoring`: ノード状態、Mempool、Fee情報の配信。
  - `/ws/monitoring/blocks`: ブロック生成イベントの配信。
  - `/ws/monitoring/packets`: IBCパケットイベントの配信。
  - `/ws/experiment/progress`: 実験進捗、ログ、結果詳細の配信。

---

### 5. 非機能要件

- **5.1. 性能要件**
  - モニタリングデータは1秒間隔、ブロック生成は3秒間隔で更新されること。
  - `BlockFeed`等の高頻度更新コンポーネントは`React.memo`等を活用し、レンダリングパフォーマンスを維持すること。
- **5.2. ユーザビリティ要件**
  - **FSD (Feature Sliced Design)** に基づく堅牢なアーキテクチャ。
  - 全画面で**Tailwind CSS**ベースの統一されたモダンUI。
  - 複雑な操作（実験設定など）における適切なバリデーションとフィードバック（Toasts）。
  - レスポンシブ対応（リサイズ可能なボトムパネル、Collapsibleサイドバー）。

---

### 6. データモデル定義 (主要エンティティ)

- `Account`: UserAccount, SystemAccount
- `Node`: NodeStatus, BlockEvent, PacketEvent
- `Scenario`: ExperimentScenario, ExperimentConfig
- `Result`: ExperimentResult (Performance & Economic Metrics)
- `Preset`: ExperimentPreset (Config & GeneratorState)
